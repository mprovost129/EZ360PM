{# core/templates/core/pdf/invoice.html #}
{% load static %}
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Invoice {{ inv.number }}</title>
  <style>
    /* Simple, PDF-safe styles (wkhtmltopdf/WeasyPrint friendly) */
    * { box-sizing: border-box; }
    body { font-family: Arial, Helvetica, sans-serif; font-size: 12px; color:#222; margin: 24px; }
    .row { width:100%; display:table; table-layout:fixed; }
    .col { display:table-cell; vertical-align:top; }
    .right { text-align:right; }
    .muted { color:#666; }
    .title { font-size:22px; font-weight:700; }
    .mb-2 { margin-bottom:8px; }
    .mb-3 { margin-bottom:12px; }
    .mb-4 { margin-bottom:16px; }
    table { width:100%; border-collapse:collapse; }
    th, td { padding:8px; border-bottom:1px solid #ddd; vertical-align:top; }
    th { background:#f6f6f6; text-align:left; }
    tfoot th, tfoot td { background:#fff; border:0; }
    .totals td:first-child { width:80%; }
    /* Avoid breaking rows across pages */
    tr { page-break-inside: avoid; }
  </style>
</head>
<body>

  <!-- Header -->
  <div class="row mb-4">
    <div class="col" style="width:65%;">
      <div class="title">Invoice {{ inv.number }}</div>
      <div class="muted">Issue date: {{ inv.issue_date|date:"Y-m-d" }}</div>
      {% if inv.due_date %}<div class="muted">Due: {{ inv.due_date|date:"Y-m-d" }}</div>{% endif %}
      {% if inv.project %}<div class="muted">Project: {{ inv.project.name }}</div>{% endif %}
    </div>
    <div class="col right" style="width:35%;">
      {% if inv.company and inv.company.logo %}
        <img src="{{ inv.company.logo.url }}" alt="Logo" style="max-height:60px;">
      {% endif %}
      <div><strong>{{ inv.company.name }}</strong></div>
      {% if inv.company.phone %}<div class="muted">{{ inv.company.phone }}</div>{% endif %}
      {% if inv.company.address %}<div class="muted" style="white-space:pre-line">{{ inv.company.address }}</div>{% endif %}
    </div>
  </div>

  <!-- Parties -->
  <div class="row mb-3">
    <div class="col" style="width:50%;">
      <strong>Bill To</strong><br>
      {% if inv.client %}
        {% if inv.client.org %}{{ inv.client.org }}<br>{% endif %}
        {% if inv.client.first_name or inv.client.last_name %}
          {{ inv.client.first_name }} {{ inv.client.last_name }}<br>
        {% endif %}
        {% if inv.client.email %}{{ inv.client.email }}<br>{% endif %}
        {% if inv.client.address %}<span class="muted" style="white-space:pre-line">{{ inv.client.address }}</span>{% endif %}
      {% else %}
        â€”
      {% endif %}
    </div>
  </div>

  <!-- Line items -->
  <table>
    <thead>
      <tr>
        <th>Description</th>
        <th class="right" style="width:80px;">Qty</th>
        <th class="right" style="width:100px;">Rate</th>
        <th class="right" style="width:110px;">Amount</th>
      </tr>
    </thead>
    <tbody>
      {% for item in inv.items.all %}
        <tr>
          <td>{{ item.description }}</td>
          <td class="right">{{ item.qty|default:"0" }}</td>
          <td class="right">${{ item.unit_price|default:"0.00" }}</td>
          <td class="right">${{ item.line_total|default:"0.00" }}</td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="4" class="muted">No items</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Totals -->
  <table class="totals" style="margin-top:16px;">
    <tr>
      <td class="right">Subtotal</td>
      <td class="right">${{ inv.subtotal|default:"0.00" }}</td>
    </tr>
    <tr>
      <td class="right">Tax</td>
      <td class="right">${{ inv.tax|default:"0.00" }}</td>
    </tr>
    <tr>
      <td class="right"><strong>Total</strong></td>
      <td class="right"><strong>${{ inv.total|default:"0.00" }}</strong></td>
    </tr>
    <tr>
      <td class="right">Paid</td>
      <td class="right">${{ inv.amount_paid|default:"0.00" }}</td>
    </tr>
    <tr>
      <td class="right"><strong>Balance</strong></td>
      <td class="right"><strong>${{ inv.balance|default:"0.00" }}</strong></td>
    </tr>
  </table>

  {% if inv.notes %}
    <p class="muted" style="margin-top:18px; white-space:pre-line;">{{ inv.notes }}</p>
  {% endif %}

</body>
</html>
