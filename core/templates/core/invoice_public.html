{% extends "_public.html" %}
{% block title %}Invoice {{ inv.number }}{% endblock %}
{% block content %}
<div class="container py-4" style="max-width:900px">
  <div class="d-flex justify-content-between align-items-start mb-3">
    <div>
      <div class="text-muted small">Invoice</div>
      <div class="h4 mb-0">{{ inv.number }}</div>
      <div class="text-muted">{{ inv.client }}</div>
    </div>
    <div class="text-end">
      <div class="text-muted small">Issued</div>
      <div>{{ inv.issue_date|date:'Y-m-d' }}</div>
      <div class="text-muted small">Due</div>
      <div>{{ inv.due_date|date:'Y-m-d' }}</div>
    </div>
  </div>

  <div class="card shadow-sm mb-3">
    <div class="table-responsive">
      <table class="table align-middle mb-0">
        <thead><tr><th>Description</th><th class="text-end">Qty</th><th class="text-end">Unit</th><th class="text-end">Line</th></tr></thead>
        <tbody>
          {% for it in inv.items.all %}
          <tr>
            <td>{{ it.description }}</td>
            <td class="text-end">{{ it.qty }}</td>
            <td class="text-end">${{ it.unit_price }}</td>
            <td class="text-end">${{ it.line_total }}</td>
          </tr>
          {% empty %}
          <tr><td colspan="4" class="text-center text-muted py-3">No items.</td></tr>
          {% endfor %}
        </tbody>
        <tfoot>
          <tr><th colspan="3" class="text-end">Subtotal</th><th class="text-end">${{ inv.subtotal }}</th></tr>
          <tr><th colspan="3" class="text-end">Tax</th><th class="text-end">${{ inv.tax }}</th></tr>
          <tr><th colspan="3" class="text-end">Total</th><th class="text-end">${{ inv.total }}</th></tr>
          <tr><th colspan="3" class="text-end">Paid</th><th class="text-end">${{ inv.amount_paid }}</th></tr>
          <tr><th colspan="3" class="text-end">Balance</th><th class="text-end">${{ inv.balance }}</th></tr>
        </tfoot>
      </table>
    </div>
  </div>

  {% if inv.balance > 0 %}
  <div class="d-grid">
    <a class="btn btn-primary btn-lg" href="{% url 'core:invoice_checkout' inv.public_token %}">Pay ${{ inv.balance }} securely</a>
  </div>
  {% else %}
  <div class="alert alert-success">This invoice is paid. Thank you!</div>
  {% endif %}

  {% if inv.notes %}
  <div class="card shadow-sm mt-3"><div class="card-body">
    <div class="fw-semibold">Notes</div>
    <div class="text-muted">{{ inv.notes|linebreaks }}</div>
  </div></div>
  {% endif %}
</div>
{% endblock %}