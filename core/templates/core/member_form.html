{# templates/core/member_edit.html #}
{% extends "_app_shell.html" %}
{% block page_title %}Edit Member{% endblock %}

{% block app_content %}
<div class="card shadow-sm">
  <div class="card-body">

    {# Header with avatar initial + identity #}
    {% firstof member.user.get_full_name member.user.email member.user.get_username as display_name %}
    <div class="d-flex align-items-center gap-3 mb-3">
      <div class="rounded-circle bg-light d-flex align-items-center justify-content-center"
           style="width:48px;height:48px;">
        <span class="fw-semibold">{{ display_name|slice:":1"|upper }}</span>
      </div>
      <div>
        <div class="fw-semibold">{{ display_name }}</div>
        <div class="text-muted small">
          {{ member.company.name }} · {{ member.get_role_display|default:member.role|capfirst }}
          {% if member.job_title %} ({{ member.job_title }}){% endif %}
        </div>
      </div>
    </div>

    {# Optional guards / notices #}
    {% if member.role == 'owner' %}
      <div class="alert alert-warning py-2 mb-3">
        You’re editing an Owner. Some changes may be restricted by policy.
      </div>
    {% elif is_self %}
      <div class="alert alert-info py-2 mb-3">
        You’re editing your own membership.
      </div>
    {% endif %}

    <form method="post" class="row g-3">
      {% csrf_token %}

      {# Non-field errors #}
      {% if form.non_field_errors %}
        <div class="col-12">
          <div class="alert alert-danger mb-0">
            {{ form.non_field_errors }}
          </div>
        </div>
      {% endif %}

      <div class="col-12 col-md-4">
        <label class="form-label" for="{{ form.role.id_for_label }}">Role</label>
        {{ form.role }}
        {% if form.role.errors %}
          <div class="text-danger small mt-1">{{ form.role.errors|join:", " }}</div>
        {% endif %}
      </div>

      <div class="col-12 col-md-4">
        <label class="form-label" for="{{ form.job_title.id_for_label }}">Job title</label>
        {{ form.job_title }}
        {% if form.job_title.errors %}
          <div class="text-danger small mt-1">{{ form.job_title.errors|join:", " }}</div>
        {% endif %}
      </div>

      <div class="col-12 col-md-4">
        <label class="form-label" for="{{ form.hourly_rate.id_for_label }}">Hourly rate</label>
        <div class="input-group">
          <span class="input-group-text">$</span>
          {{ form.hourly_rate }}
        </div>
        <div class="form-text">Optional. Used for reporting/invoicing.</div>
        {% if form.hourly_rate.errors %}
          <div class="text-danger small mt-1">{{ form.hourly_rate.errors|join:", " }}</div>
        {% endif %}
      </div>

      <div class="col-12 d-flex gap-2">
        <button class="btn btn-primary">Save</button>
        <a class="btn btn-outline-secondary" href="{% url 'core:team_list' %}">Cancel</a>
      </div>
    </form>

    {# Optional: Danger zone with remove link (hidden for self/owner unless your policy allows) #}
    <hr class="my-4">
    <div class="d-flex justify-content-between align-items-center">
      <div class="text-muted small">Danger zone</div>
      <div class="d-flex gap-2">
        <a class="btn btn-outline-danger btn-sm"
           href="{% url 'core:member_remove' member.id %}"
           {% if is_self or member.role == 'owner' or not can_remove %}aria-disabled="true" tabindex="-1" class="btn btn-outline-danger btn-sm disabled"{% endif %}>
          Remove from company
        </a>
      </div>
    </div>

  </div>
</div>
{% endblock %}
