{% extends "base_app.html" %}
{% block title %}Site settings Â· EZ360PM{% endblock %}

{% block content %}
<div class="container-fluid" style="max-width: 980px;">
  <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
    <div>
      <h1 class="h4 mb-1">Site settings</h1>
      <div class="text-secondary small">Platform-level configuration managed inside EZ360PM (no Django admin).</div>
    </div>
    <div class="d-flex gap-2">
      <a class="btn btn-outline-dark" href="{% url 'ops:settings_home' %}">Back to settings</a>
      <a class="btn btn-outline-dark" href="{% url 'ops:dashboard' %}">Back to Ops</a>
    </div>
  </div>

  <form method="post" class="card shadow-sm">
    {% csrf_token %}
    <div class="card-body">

      <h2 class="h6">Maintenance mode</h2>
      <div class="row g-2 align-items-end">
        <div class="col-12">
          <div class="form-check">
            {{ form.maintenance_mode_enabled }}
            <label class="form-check-label" for="{{ form.maintenance_mode_enabled.id_for_label }}">Enable maintenance mode</label>
          </div>
        </div>
        <div class="col-12">
          <div class="form-check">
            {{ form.maintenance_allow_staff }}
            <label class="form-check-label" for="{{ form.maintenance_allow_staff.id_for_label }}">Allow staff to use the app during maintenance</label>
          </div>
        </div>
        <div class="col-12">
          <label class="form-label">Message (optional)</label>
          {{ form.maintenance_message }}
        </div>
      </div>

      <hr class="my-4">

      <h2 class="h6">Billing trial (fallback default)</h2>
      <div class="row g-2 align-items-end">
        <div class="col-12 col-md-4">
          <label class="form-label">Trial days</label>
          {{ form.billing_trial_days }}
          <div class="text-secondary small mt-1">Used only when a plan catalog entry does not specify trial days.</div>
        </div>
      </div>

      <hr class="my-4">

      <h2 class="h6">Owner notifications</h2>
      <div class="text-secondary small mb-2">High-signal lifecycle emails for the platform operator (separate from Ops Alerts).</div>
      <div class="row g-2 align-items-end">
        <div class="col-12">
          <div class="form-check">
            {{ form.ops_notify_email_enabled }}
            <label class="form-check-label" for="{{ form.ops_notify_email_enabled.id_for_label }}">Enable ops notification emails</label>
          </div>
        </div>
        <div class="col-12">
          <label class="form-label">Recipients</label>
          {{ form.ops_notify_email_recipients }}
          <div class="text-secondary small mt-1">Comma-separated email addresses.</div>
        </div>
        <div class="col-12 col-md-6">
          <div class="form-check">
            {{ form.ops_notify_on_company_signup }}
            <label class="form-check-label" for="{{ form.ops_notify_on_company_signup.id_for_label }}">Notify on new company signup</label>
          </div>
        </div>
        <div class="col-12 col-md-6">
          <div class="form-check">
            {{ form.ops_notify_on_subscription_active }}
            <label class="form-check-label" for="{{ form.ops_notify_on_subscription_active.id_for_label }}">Notify when subscription becomes active</label>
          </div>
        </div>
      </div>

      <hr class="my-4">

      <h2 class="h6">Ops alert routing</h2>
      <div class="text-secondary small mb-2">Controls webhook/email delivery for Ops Alerts (alerts are always stored in the database).</div>

      <div class="row g-2 align-items-end">
        <div class="col-12">
          <div class="form-check">
            {{ form.ops_alert_webhook_enabled }}
            <label class="form-check-label" for="{{ form.ops_alert_webhook_enabled.id_for_label }}">Enable webhook delivery</label>
          </div>
        </div>
        <div class="col-12">
          <label class="form-label">Webhook URL</label>
          {{ form.ops_alert_webhook_url }}
          {% if form.ops_alert_webhook_url.errors %}<div class="text-danger small">{{ form.ops_alert_webhook_url.errors|join:", " }}</div>{% endif %}
        </div>
        <div class="col-12 col-md-4">
          <label class="form-label">Timeout (seconds)</label>
          {{ form.ops_alert_webhook_timeout_seconds }}
        </div>
      </div>

      <hr class="my-3">

      <div class="row g-2 align-items-end">
        <div class="col-12">
          <div class="form-check">
            {{ form.ops_alert_email_enabled }}
            <label class="form-check-label" for="{{ form.ops_alert_email_enabled.id_for_label }}">Enable email delivery</label>
          </div>
        </div>
        <div class="col-12">
          <label class="form-label">Recipients</label>
          {{ form.ops_alert_email_recipients }}
          <div class="text-secondary small mt-1">Comma-separated email addresses.</div>
        </div>
        <div class="col-12 col-md-4">
          <label class="form-label">Minimum level</label>
          {{ form.ops_alert_email_min_level }}
        </div>
      </div>

      <hr class="my-3">

      <h3 class="h6 mt-3">Noise filters</h3>
      <div class="row g-2">
        <div class="col-12 col-md-6">
          <label class="form-label">Ignore path prefixes</label>
          {{ form.ops_alert_noise_path_prefixes }}
        </div>
        <div class="col-12 col-md-6">
          <label class="form-label">Ignore user agent tokens</label>
          {{ form.ops_alert_noise_user_agents }}
        </div>
      </div>

      <div class="row g-2 mt-2">
        <div class="col-12 col-md-4">
          <label class="form-label">Dedup minutes</label>
          {{ form.ops_alert_dedup_minutes }}
        </div>
        <div class="col-12 col-md-4">
          <label class="form-label">Prune resolved after (days)</label>
          {{ form.ops_alert_prune_resolved_after_days }}
        </div>
        <div class="col-12 col-md-4">
          <label class="form-label">Prune expired snoozes after (days)</label>
          {{ form.ops_snooze_prune_after_days }}
        </div>
      </div>

    </div>
    <div class="card-footer d-flex align-items-center justify-content-between">
      <div class="text-secondary small">Changes apply immediately.</div>
      <button class="btn btn-ez" type="submit">Save settings</button>
    </div>
  </form>
</div>
{% endblock %}
