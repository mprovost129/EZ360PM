{# templates/base_public.html #}
{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#0d6efd" />
    <meta name="color-scheme" content="light dark" />

    <title>{% block head_title %}{{ APP_NAME }}{% endblock %}</title>

    {# SEO/metadata override hooks (match base.html) #}
    {% block head_meta %}{% endblock %}
    {% block head_canonical %}{% endblock %}
    {% block head_og %}{% endblock %}
    {% block head_jsonld %}{% endblock %}

    {# Bootstrap (local) — keep CDN fallback commented if you prefer #}
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet" />

    {# App styles (match base.html path) #}
    <link rel="stylesheet" href="{% static 'css/app.css' %}" />

    {# Icons/favicons hooks (you’re using local SVG icons elsewhere) #}
    {% block head_icons %}{% endblock %}
    {% block head_favicons %}{% endblock %}
    {% block extra_css %}{% endblock %}
  </head>
  <body class="{% block body_class %}{% endblock %}">
    {# Skip link for keyboard users #}
    <a href="#main-content" class="visually-hidden-focusable position-absolute top-0 start-0 m-2 px-3 py-2 bg-light border rounded">
      Skip to content
    </a>

    <header role="banner">
      {% include "includes/public_nav.html" %}
    </header>

    {# Flash messages (polite region) #}
    <div class="container mt-3" aria-live="polite" aria-atomic="true">
      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags|default:'secondary' }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}
    </div>

    {# Main content #}
    <main id="main-content" class="container py-4" role="main">
      {% block content %}{% endblock %}
    </main>

    <footer role="contentinfo">
      {% include "dashboard/legal/_cookie_banner.html" %}
      {% include "includes/footer.html" %}
    </footer>

    {# JS (local) with optional CDN fallback #}
    <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
      defer
    ></script>

    <script>
      // Optional: quick focus with Ctrl+K / Cmd+K
      document.addEventListener("keydown", (e) => {
        if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === "k") {
          const inp = document.querySelector('form[role="search"] input[type="search"]');
          if (inp) {
            e.preventDefault();
            inp.focus();
            try { inp.select(); } catch (_) {}
          }
        }
      });
    </script>

    {# Place modals/overlays here if needed #}
    {% block body_portal %}{% endblock %}
    {% block extra_js %}{% endblock %}
  </body>
</html>
