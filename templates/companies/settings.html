{% extends "base_app.html" %}
{% load static %}

{% block title %}Company settings Â· EZ360PM{% endblock %}

{% block content %}
  <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
    <div>
      <h1 class="h3 mb-0">Company settings</h1>
      <div class="text-secondary small">Manage company branding and contact details.</div>
    </div>
    <a class="btn btn-outline-dark" href="{% url 'companies:team_list' %}"><i class="bi bi-people me-1"></i>Team</a>
  </div>

  <div class="card shadow-sm">
    <div class="card-body">
      <form method="post" enctype="multipart/form-data" novalidate>
        {% csrf_token %}

        <div class="row g-3">
          <div class="col-md-8">
            <label class="form-label">Company name</label>
            {{ form.name }}
            {% if form.name.errors %}<div class="text-danger small">{{ form.name.errors|striptags }}</div>{% endif %}
          </div>
          <div class="col-md-4">
            <label class="form-label">Logo</label>
            {{ form.logo }}
            {% if company.logo %}<div class="small text-secondary mt-1">Current: {{ company.logo.name }}</div>{% endif %}
          </div>

          <div class="col-md-6">
            <label class="form-label">Email from name</label>
            {{ form.email_from_name }}
          </div>
          <div class="col-md-6">
            <label class="form-label">Email from address</label>
            {{ form.email_from_address }}
          </div>

          <div class="col-md-6">
            <label class="form-label">Address 1</label>
            {{ form.address1 }}
          </div>
          <div class="col-md-6">
            <label class="form-label">Address 2</label>
            {{ form.address2 }}
          </div>
          <div class="col-md-4">
            <label class="form-label">City</label>
            {{ form.city }}
          </div>
          <div class="col-md-4">
            <label class="form-label">State</label>
            {{ form.state }}
          </div>
          <div class="col-md-4">
            <label class="form-label">Zip</label>
            {{ form.zip_code }}
          </div>
        </div>

        <hr class="my-4">

        <div class="mb-2">
          <div class="fw-semibold">Document numbering</div>
          <div class="text-secondary small">
            Company-wide numbering patterns and counters. Patterns support: <code>{YY}</code>, <code>{YYYY}</code>, <code>{MM}</code>, <code>{DD}</code>, <code>{SEQ:3}</code>.
          </div>
        </div>

        <div class="row g-3">
          <div class="col-12"><div class="fw-semibold">Invoices</div></div>
          <div class="col-md-7">
            <label class="form-label">Invoice pattern</label>
            {{ scheme_form.invoice_pattern }}
          </div>
          <div class="col-md-3">
            <label class="form-label">Reset</label>
            {{ scheme_form.invoice_reset }}
          </div>
          <div class="col-md-2">
            <label class="form-label">Next #</label>
            {{ scheme_form.invoice_seq }}
          </div>

          <div class="col-12"><div class="fw-semibold mt-2">Estimates</div></div>
          <div class="col-md-7">
            <label class="form-label">Estimate pattern</label>
            {{ scheme_form.estimate_pattern }}
          </div>
          <div class="col-md-3">
            <label class="form-label">Reset</label>
            {{ scheme_form.estimate_reset }}
          </div>
          <div class="col-md-2">
            <label class="form-label">Next #</label>
            {{ scheme_form.estimate_seq }}
          </div>

          <div class="col-12"><div class="fw-semibold mt-2">Proposals</div></div>
          <div class="col-md-7">
            <label class="form-label">Proposal pattern</label>
            {{ scheme_form.proposal_pattern }}
          </div>
          <div class="col-md-3">
            <label class="form-label">Reset</label>
            {{ scheme_form.proposal_reset }}
          </div>
          <div class="col-md-2">
            <label class="form-label">Next #</label>
            {{ scheme_form.proposal_seq }}
          </div>
        </div>

        <div class="d-flex justify-content-end gap-2 mt-4">
          <a class="btn btn-outline-secondary" href="{% url 'core:app_dashboard' %}">Back</a>
          {% if can_edit %}
            <button class="btn btn-ez" type="submit">Save</button>
          {% else %}
            <button class="btn btn-ez" type="button" disabled>Save</button>
          {% endif %}
        </div>

        {% if not can_edit %}
          <div class="alert alert-warning mt-3 mb-0">You can view settings, but only an Owner or Admin can edit.</div>
        {% endif %}
      </form>
    </div>
  </div>
{% endblock %}
