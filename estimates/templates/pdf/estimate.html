{# estimates/templates/pdf/estimate.html #}
{% load static humanize %}
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Estimate {{ est.number }}</title>
  <style>
    /* ---- PDF-friendly, minimal styles ---- */
    * { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; }
    body { font-family: Arial, Helvetica, sans-serif; font-size: 12px; color:#222; margin: 24px; }

    .row { width:100%; display:table; table-layout:fixed; }
    .col { display:table-cell; vertical-align:top; }
    .right { text-align:right; }
    .muted { color:#666; }
    .title { font-size:22px; font-weight:700; }
    .mb-1 { margin-bottom:6px; }
    .mb-2 { margin-bottom:8px; }
    .mb-3 { margin-bottom:12px; }
    .mb-4 { margin-bottom:16px; }
    .mt-3 { margin-top:12px; }
    .mt-4 { margin-top:16px; }

    table { width:100%; border-collapse:collapse; }
    th, td { padding:8px; border-bottom:1px solid #ddd; vertical-align:top; }
    th { background:#f6f6f6; text-align:left; }

    /* Repeat header/footer rows on page breaks in PDF renderers like WeasyPrint */
    thead { display: table-header-group; }
    tfoot { display: table-row-group; }
    tr { page-break-inside: avoid; }

    /* Totals table */
    .totals td { border:0; }
    .totals td:first-child { width:80%; }
    .totals .label { text-align:right; padding-right:8px; }
    .totals .value { text-align:right; }

    /* Long text handling */
    .prewrap { white-space: pre-wrap; }
    .preline { white-space: pre-line; }

    /* Optional page styling */
    @page {
      size: A4;
      margin: 24pt;
    }
  </style>
</head>
<body>

  <!-- Header -->
  <div class="row mb-4">
    <div class="col" style="width:65%;">
      <div class="title">Estimate {{ est.number }}</div>
      <div class="muted">Issue date: {{ est.issue_date|date:"Y-m-d" }}</div>
      {% if est.valid_until %}<div class="muted">Valid until: {{ est.valid_until|date:"Y-m-d" }}</div>{% endif %}
      {% if est.project %}<div class="muted">Project: {{ est.project.name }}</div>{% endif %}
    </div>
    <div class="col right" style="width:35%;">
      {% if est.company and est.company.logo %}
        {# If you pass `request` into context, this builds an absolute URL for wkhtmltopdf/WeasyPrint #}
        {% if request %}<img src="{{ request.build_absolute_uri(est.company.logo.url) }}" alt="Logo" style="max-height:60px;">
        {% else %}<img src="{{ est.company.logo.url }}" alt="Logo" style="max-height:60px;">{% endif %}
      {% endif %}
      <div><strong>{{ est.company.name }}</strong></div>
      {% if est.company.phone %}<div class="muted">{{ est.company.phone }}</div>{% endif %}
      {% if est.company.address %}<div class="muted preline">{{ est.company.address }}</div>{% endif %}
    </div>
  </div>

  <!-- Parties -->
  <div class="row mb-3">
    <div class="col" style="width:50%;">
      <strong>To</strong><br>
      {% if est.client %}
        {% if est.client.org %}{{ est.client.org }}<br>{% endif %}
        {% if est.client.first_name or est.client.last_name %}
          {{ est.client.first_name }} {{ est.client.last_name }}<br>
        {% endif %}
        {% if est.client.email %}{{ est.client.email }}<br>{% endif %}
        {% if est.client.address %}<span class="muted preline">{{ est.client.address }}</span>{% endif %}
      {% else %}
        —
      {% endif %}
    </div>
  </div>

  <!-- Line items -->
  <table aria-label="Estimate line items">
    <thead>
      <tr>
        <th>Description</th>
        <th class="right" style="width:80px;">Qty</th>
        <th class="right" style="width:100px;">Rate</th>
        <th class="right" style="width:110px;">Amount</th>
      </tr>
    </thead>
    <tbody>
      {% for it in est.items.all %}
        <tr>
          <td>{{ it.description }}</td>
          <td class="right">{{ it.qty|default:0|floatformat:2|intcomma }}</td>
          <td class="right">${{ it.unit_price|default:0|floatformat:2|intcomma }}</td>
          <td class="right">${{ it.line_total|default:0|floatformat:2|intcomma }}</td>
        </tr>
      {% empty %}
        <tr><td colspan="4" class="muted">No items</td></tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Totals -->
  <table class="totals mt-4">
    <tr>
      <td class="label">Subtotal</td>
      <td class="value">${{ est.subtotal|default:0|floatformat:2|intcomma }}</td>
    </tr>
    <tr>
      <td class="label">Tax</td>
      <td class="value">${{ est.tax|default:0|floatformat:2|intcomma }}</td>
    </tr>
    <tr>
      <td class="label"><strong>Total</strong></td>
      <td class="value"><strong>${{ est.total|default:0|floatformat:2|intcomma }}</strong></td>
    </tr>
  </table>

  {% if est.notes %}
    <p class="muted mt-4 preline">{{ est.notes }}</p>
  {% endif %}

</body>
</html>
{# core/templates/core/pdf/estimate.html #}
{% load static humanize %}
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Estimate {{ est.number }}</title>
  <style>
    /* ---- PDF-friendly, minimal styles ---- */
    * { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; }
    body { font-family: Arial, Helvetica, sans-serif; font-size: 12px; color:#222; margin: 24px; }

    .row { width:100%; display:table; table-layout:fixed; }
    .col { display:table-cell; vertical-align:top; }
    .right { text-align:right; }
    .muted { color:#666; }
    .title { font-size:22px; font-weight:700; }
    .mb-1 { margin-bottom:6px; }
    .mb-2 { margin-bottom:8px; }
    .mb-3 { margin-bottom:12px; }
    .mb-4 { margin-bottom:16px; }
    .mt-3 { margin-top:12px; }
    .mt-4 { margin-top:16px; }

    table { width:100%; border-collapse:collapse; }
    th, td { padding:8px; border-bottom:1px solid #ddd; vertical-align:top; }
    th { background:#f6f6f6; text-align:left; }

    /* Repeat header/footer rows on page breaks in PDF renderers like WeasyPrint */
    thead { display: table-header-group; }
    tfoot { display: table-row-group; }
    tr { page-break-inside: avoid; }

    /* Totals table */
    .totals td { border:0; }
    .totals td:first-child { width:80%; }
    .totals .label { text-align:right; padding-right:8px; }
    .totals .value { text-align:right; }

    /* Long text handling */
    .prewrap { white-space: pre-wrap; }
    .preline { white-space: pre-line; }

    /* Optional page styling */
    @page {
      size: A4;
      margin: 24pt;
    }
  </style>
</head>
<body>

  <!-- Header -->
  <div class="row mb-4">
    <div class="col" style="width:65%;">
      <div class="title">Estimate {{ est.number }}</div>
      <div class="muted">Issue date: {{ est.issue_date|date:"Y-m-d" }}</div>
      {% if est.valid_until %}<div class="muted">Valid until: {{ est.valid_until|date:"Y-m-d" }}</div>{% endif %}
      {% if est.project %}<div class="muted">Project: {{ est.project.name }}</div>{% endif %}
    </div>
    <div class="col right" style="width:35%;">
      {% if est.company and est.company.logo %}
        {# If you pass `request` into context, this builds an absolute URL for wkhtmltopdf/WeasyPrint #}
        {% if request %}<img src="{{ request.build_absolute_uri(est.company.logo.url) }}" alt="Logo" style="max-height:60px;">
        {% else %}<img src="{{ est.company.logo.url }}" alt="Logo" style="max-height:60px;">{% endif %}
      {% endif %}
      <div><strong>{{ est.company.name }}</strong></div>
      {% if est.company.phone %}<div class="muted">{{ est.company.phone }}</div>{% endif %}
      {% if est.company.address %}<div class="muted preline">{{ est.company.address }}</div>{% endif %}
    </div>
  </div>

  <!-- Parties -->
  <div class="row mb-3">
    <div class="col" style="width:50%;">
      <strong>To</strong><br>
      {% if est.client %}
        {% if est.client.org %}{{ est.client.org }}<br>{% endif %}
        {% if est.client.first_name or est.client.last_name %}
          {{ est.client.first_name }} {{ est.client.last_name }}<br>
        {% endif %}
        {% if est.client.email %}{{ est.client.email }}<br>{% endif %}
        {% if est.client.address %}<span class="muted preline">{{ est.client.address }}</span>{% endif %}
      {% else %}
        —
      {% endif %}
    </div>
  </div>

  <!-- Line items -->
  <table aria-label="Estimate line items">
    <thead>
      <tr>
        <th>Description</th>
        <th class="right" style="width:80px;">Qty</th>
        <th class="right" style="width:100px;">Rate</th>
        <th class="right" style="width:110px;">Amount</th>
      </tr>
    </thead>
    <tbody>
      {% for it in est.items.all %}
        <tr>
          <td>{{ it.description }}</td>
          <td class="right">{{ it.qty|default:0|floatformat:2|intcomma }}</td>
          <td class="right">${{ it.unit_price|default:0|floatformat:2|intcomma }}</td>
          <td class="right">${{ it.line_total|default:0|floatformat:2|intcomma }}</td>
        </tr>
      {% empty %}
        <tr><td colspan="4" class="muted">No items</td></tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Totals -->
  <table class="totals mt-4">
    <tr>
      <td class="label">Subtotal</td>
      <td class="value">${{ est.subtotal|default:0|floatformat:2|intcomma }}</td>
    </tr>
    <tr>
      <td class="label">Tax</td>
      <td class="value">${{ est.tax|default:0|floatformat:2|intcomma }}</td>
    </tr>
    <tr>
      <td class="label"><strong>Total</strong></td>
      <td class="value"><strong>${{ est.total|default:0|floatformat:2|intcomma }}</strong></td>
    </tr>
  </table>

  {% if est.notes %}
    <p class="muted mt-4 preline">{{ est.notes }}</p>
  {% endif %}

</body>
</html>
