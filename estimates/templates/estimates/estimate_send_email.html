{% extends "base.html" %}
{% block page_title %}{% if mode == "reminder" %}Send Reminder{% else %}Send Estimate{% endif %} {{ est.number }}{% endblock %}

{% block app_content %}
<div class="card shadow-sm">
  <div class="card-body">

    {% if not est.client or not est.client.email %}
      <div class="alert alert-warning" role="alert">
        This estimate’s client doesn’t have an email on file.
        Add one to
        <a href="{% url 'clients:clients' %}?q={{ est.client|urlencode }}" class="alert-link">
          {{ est.client }}
        </a>
        first, or enter a recipient below.
      </div>
    {% endif %}

    <form method="post" novalidate>
      {% csrf_token %}

      <!-- To -->
      <div class="mb-3">
        <label class="form-label" for="id_to">To</label>
        <input
          id="id_to"
          type="email"
          name="to"
          class="form-control"
          required
          inputmode="email"
          autocomplete="email"
          value="{{ request.POST.to|default:default_to }}"
          placeholder="{{ est.client.email|default:'client@example.com' }}"
          aria-describedby="toHelp"
          autofocus
        >
        <div id="toHelp" class="form-text">
          We’ll send from your company email settings.
        </div>
      </div>

      <!-- Message -->
      <div class="mb-3">
        <label class="form-label" for="id_note">
          {% if mode == "reminder" %}Reminder message{% else %}Message (optional){% endif %}
        </label>
        <textarea
          id="id_note"
          name="note"
          class="form-control"
          rows="4"
          placeholder="{% if mode == 'reminder' %}Friendly reminder about your estimate…{% else %}Add a short note to your client…{% endif %}"
          aria-describedby="noteHelp"
        >{{ request.POST.note }}</textarea>
        <div id="noteHelp" class="form-text">
          We’ll include a secure view link{% if attach_pdf %} and attach a PDF{% endif %}.
        </div>
      </div>

      <!-- Actions -->
      <div class="d-flex gap-2">
        <button class="btn btn-primary" type="submit">
          {% if mode == "reminder" %}Send reminder{% else %}Send estimate{% endif %}
        </button>
        <a class="btn btn-outline-secondary" href="{% url 'estimates:estimate_detail' est.pk %}">Cancel</a>
      </div>
    </form>
  </div>
</div>
{% endblock %}
