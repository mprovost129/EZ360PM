{% extends "base_app.html" %}
{% load formatting %}
{% block title %}{% if mode == "edit" %}Edit Project{% else %}New Project{% endif %} Â· EZ360PM{% endblock %}

{% block content %}
<div class="d-flex align-items-center justify-content-between mb-3">
  <div>
    <h1 class="h3 mb-0">{% if mode == "edit" %}Edit project{% else %}New project{% endif %}</h1>
    <div class="text-secondary small">Projects tie clients, time, expenses, and documents together.</div>
  </div>
  <a class="btn btn-outline-secondary" href="{% url 'projects:project_list' %}"><i class="bi bi-arrow-left me-1"></i>Back</a>
</div>

<form method="post" class="card shadow-sm">
  {% csrf_token %}
  <div class="card-body">
    <div class="row g-3">
      <div class="col-md-6">
        <label class="form-label">Client</label>
        {{ form.client }}
        {% for e in form.client.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
      </div>
      <div class="col-md-6">
        <label class="form-label">Assigned to</label>
        {{ form.assigned_to }}
        {% for e in form.assigned_to.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
      </div>

      <div class="col-md-4">
        <label class="form-label">Project number</label>
        {{ form.project_number }}
        <div class="form-text">Leave blank to auto-generate.</div>
        {% for e in form.project_number.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
      </div>
      <div class="col-md-8">
        <label class="form-label">Project name</label>
        {{ form.name }}
        {% for e in form.name.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
      </div>

      <div class="col-12">
        <label class="form-label">Description</label>
        {{ form.description }}
        {% for e in form.description.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
      </div>

      <div class="col-md-4">
        <label class="form-label">Date received</label>
        {{ form.date_received }}
      </div>
      <div class="col-md-4">
        <label class="form-label">Due date</label>
        {{ form.due_date }}
      </div>
      <div class="col-md-4">
        <label class="form-label">Estimated hours</label>
        {{ form.estimated_hours }}
        <div class="form-text">Examples: 10h 30m, 10:30, or minutes.</div>
        {% for e in form.estimated_hours.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
      </div>

      <div class="col-md-4">
        <label class="form-label">Billing type</label>
        {{ form.billing_type }}
      </div>
      <div class="col-md-4">
        <label class="form-label">Hourly rate (cents)</label>
        {{ form.hourly_rate_cents }}
        <div class="form-text">Later: auto from employee profile.</div>
      </div>
      <div class="col-md-4">
        <label class="form-label">Flat fee (cents)</label>
        {{ form.flat_fee_cents }}
      </div>
    </div>

    <hr class="my-4">

    <h2 class="h5 mb-2">Services</h2>
    <div class="text-secondary small mb-3">Add one or more services typically performed on this project. (Catalog integration comes next.)</div>

    {{ formset.management_form }}
    <div class="row g-3">
      {% for f in formset %}
        <div class="col-12">
          <div class="border rounded-3 p-3 bg-white">
            <div class="row g-2 align-items-start">
              <div class="col-md-4">
                <label class="form-label small">Service name</label>
                {{ f.name }}
                {% for e in f.name.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
              </div>
              <div class="col-md-7">
                <label class="form-label small">Notes</label>
                {{ f.notes }}
              </div>
              <div class="col-md-1">
                {% if f.instance.pk %}
                  <label class="form-label small">Del</label>
                  {{ f.DELETE }}
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>

  <div class="card-footer d-flex justify-content-between">
    <a class="btn btn-outline-secondary" href="{% url 'projects:project_list' %}">Cancel</a>
    <button class="btn btn-dark" type="submit">Save</button>
  </div>
</form>
{% endblock %}
