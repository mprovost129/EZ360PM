{% extends "helpcenter/_help_base.html" %}

{% block help_h1 %}Production runbook{% endblock %}

{% block help_body %}
<p class="text-secondary">This runbook is the “corporate checklist” for operating EZ360PM in production: deployment checks, daily ops, and incident hygiene.</p>

<h2 class="h6 mt-3">Before each deploy</h2>
<ol>
  <li>Run Ops → Checks → <strong>Run all</strong> (or run <code>ez360_run_ops_checks_daily</code>).</li>
  <li>Confirm <strong>migrations</strong> are applied and there are no pending migrations.</li>
  <li>Confirm <strong>staticfiles</strong> are collected and the app UI renders (especially Admin).</li>
  <li>Confirm email configuration is valid (receipt/document emails should deliver).</li>
</ol>

<h2 class="h6 mt-3">Daily routine</h2>
<ul>
  <li>Run: <code>python manage.py ez360_run_ops_checks_daily</code></li>
  <li>Review Ops → Checks → Recent Runs for failures/warnings.</li>
  <li>Prune evidence: <code>python manage.py ez360_prune_ops_check_runs --days 30</code></li>
</ul>

<h2 class="h6 mt-3">Scheduling (Render / hosted)</h2>
<p class="text-secondary small mb-2">EZ360PM includes a few management commands intended to run on a schedule. On Render, use <strong>Cron Jobs</strong>. On other hosts, use your platform scheduler (cron, CI, or task runner).</p>
<ul>
  <li><strong>Daily ops checks (daily)</strong>: <code>python manage.py ez360_run_ops_checks_daily</code></li>
  <li><strong>Statement reminders (hourly or daily)</strong>: <code>python manage.py ez360_send_statement_reminders</code></li>
  <li><strong>Prune ops evidence (weekly)</strong>: <code>python manage.py ez360_prune_ops_check_runs --days 30</code></li>
  <li><strong>Prune resolved ops alerts (weekly)</strong>: <code>python manage.py ez360_prune_ops_alerts</code></li>
</ul>

<div class="alert alert-light border small mb-0">
  <div class="fw-semibold mb-1">Recommended Render cron setup</div>
  <ol class="mb-0">
    <li>Create a cron job: <code>0 7 * * *</code> → <code>python manage.py ez360_run_ops_checks_daily</code></li>
    <li>Create a cron job: <code>0 * * * *</code> → <code>python manage.py ez360_send_statement_reminders</code></li>
    <li>Create a cron job: <code>0 3 * * 0</code> → <code>python manage.py ez360_prune_ops_check_runs --days 30</code></li>
    <li>Create a cron job: <code>15 3 * * 0</code> → <code>python manage.py ez360_prune_ops_alerts</code></li>
  </ol>
  <div class="text-secondary mt-2">Tip: set alert routing in Ops → Alert routing so failures notify you by email/webhook.</div>
</div>
<h2 class="h6 mt-3">Incident workflow</h2>
<ul>
  <li>Capture evidence: download Ops runs output (Ops → Checks → Recent Runs).</li>
  <li>Check server logs and any configured error reporting.</li>
  <li>If a financial inconsistency is detected, run <code>ez360_invariants_check</code> scoped to the company.</li>
</ul>

<div class="alert alert-light border mt-3 mb-0">
  <div class="small text-secondary">See also:</div>
  <div class="d-flex flex-wrap gap-2 mt-1">
    <a class="btn btn-sm btn-outline-dark" href="{% url 'helpcenter:ops_console' %}">Ops Console</a>
    <a class="btn btn-sm btn-outline-dark" href="{% url 'helpcenter:ops' %}">Ops guide</a>
  </div>
</div>
{% endblock %}
