# EZ360PM Example Environment (.env)
# ------------------------------------------------------------------------------
# Choose settings profile
DJANGO_SETTINGS_MODULE=config.settings.dev
# For production:
# DJANGO_SETTINGS_MODULE=config.settings.prod

# ------------------------------------------------------------------------------
# Core
SECRET_KEY=change-me-to-a-long-random-string
DEBUG=1  # dev only; prod.py forces DEBUG=0
TIME_ZONE=America/New_York
SITE_NAME=EZ360PM
TWO_FACTOR_ISSUER=EZ360PM
TWO_FACTOR_SESSION_TTL_SECONDS=43200

# Build / release metadata (optional but strongly recommended for staging/prod)
# These are safe to expose via /version and the Ops dashboard.
APP_ENVIRONMENT=dev
BUILD_VERSION=
BUILD_SHA=
BUILD_DATE=

# ------------------------------------------------------------------------------
# Hosts / Security (set in prod/staging)
# Comma-separated
ALLOWED_HOSTS=127.0.0.1,localhost
# Comma-separated, must include scheme for https
CSRF_TRUSTED_ORIGINS=http://127.0.0.1:8000,http://localhost:8000

# IMPORTANT:
# - In dev, Phase 3Y forces HTTP by default.
# - In prod, set SECURE_SSL_REDIRECT=1 and configure your proxy headers correctly.
SECURE_SSL_REDIRECT=0
SESSION_COOKIE_SECURE=0
CSRF_COOKIE_SECURE=0
SESSION_COOKIE_SAMESITE=Lax
CSRF_COOKIE_SAMESITE=Lax

# HSTS (prod only)
SECURE_HSTS_SECONDS=0

# Proxy / Render / Load balancer (prod only)
USE_X_FORWARDED_HOST=1
TRUST_X_FORWARDED_PROTO=1

# ----------------------------------------------------------------------------
# Static files (Render / production)
# WhiteNoise serves /static/ from STATIC_ROOT.
# If a deploy ever fails due to a missing static manifest (collectstatic not run),
# you can temporarily set this to 0 to recover while you fix the deploy pipeline.
WHITENOISE_MANIFEST_STRICT=1

# ------------------------------------------------------------------------------
# Database (choose ONE approach)

# Option A (recommended): DATABASE_URL
# Example (local Postgres):
# DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/ez360pm
DATABASE_URL=

# Option B: Discrete Postgres vars (used if DATABASE_URL is empty)
POSTGRES_DB=ez360pm
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_HOST=127.0.0.1
POSTGRES_PORT=5432

# DB connection pooling / keepalive
DB_CONN_MAX_AGE=60

# ------------------------------------------------------------------------------
# Cache (optional)
EZ360_CACHE_ENABLED=0
REDIS_URL=redis://127.0.0.1:6379/1

# ------------------------------------------------------------------------------
# Email
# Dev options:
# EMAIL_BACKEND=django.core.mail.backends.console.EmailBackend
# Prod options (SMTP):
# EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend
EMAIL_BACKEND=django.core.mail.backends.console.EmailBackend
EMAIL_HOST=
EMAIL_PORT=587
EMAIL_HOST_USER=
EMAIL_HOST_PASSWORD=
EMAIL_USE_TLS=1

DEFAULT_FROM_EMAIL=no-reply@ez360pm.local
DEFAULT_REPLY_TO_EMAIL=support@ez360pm.local
SUPPORT_EMAIL=support@ez360pm.local
SERVER_EMAIL=errors@ez360pm.local
EMAIL_SUBJECT_PREFIX=[EZ360PM]

# Alert toggles (Phase 4 hooks)
EZ360_ALERT_ON_EMAIL_FAILURE=1
EZ360_ALERT_ON_WEBHOOK_FAILURE=1

# Optional: Django ADMINS (comma-separated)
# Format: "Name:email,Name2:email2" or "email,email2"
EZ360_ADMINS=

# ------------------------------------------------------------------------------
# Stripe
STRIPE_SECRET_KEY=
STRIPE_PUBLISHABLE_KEY=
STRIPE_WEBHOOK_SECRET=
# JSON mapping used by billing/subscriptions (keep as JSON)
STRIPE_PRICE_MAP_JSON={"standard:solo":"price_...","premium:solo":"price_..."}
# Optional: Stripe portal configuration id (if you created one in Stripe)
STRIPE_PORTAL_CONFIGURATION_ID=

# ------------------------------------------------------------------------------
# reCAPTCHA v3
RECAPTCHA_ENABLED=0
RECAPTCHA_SITE_KEY=
RECAPTCHA_SECRET_KEY=
RECAPTCHA_MIN_SCORE=0.5

# ------------------------------------------------------------------------------
# Dropbox (optional integration)
DROPBOX_APP_KEY=
DROPBOX_APP_SECRET=
DROPBOX_REDIRECT_URI=

# ------------------------------------------------------------------------------
# Monitoring / Observability (Phase 4)
# Sentry is enabled only when SENTRY_DSN is set.
SENTRY_DSN=
SENTRY_ENVIRONMENT=dev
SENTRY_TRACES_SAMPLE_RATE=0.05
SENTRY_PROFILES_SAMPLE_RATE=0.0

# ------------------------------------------------------------------------------
# Performance logging (Phase 3W / 4)
# Dev defaults are safe; enable/adjust as needed.
EZ360_PERF_LOGGING_ENABLED=1
EZ360_PERF_REQUEST_MS=600
EZ360_PERF_QUERY_MS=120
EZ360_PERF_TOP_N=5
EZ360_PERF_SAMPLE_RATE=1.0
EZ360_PERF_STORE_DB=0

# ------------------------------------------------------------------------------
# Dev HTTPS opt-in (Phase 3Y)
# Leave 0 for normal http://127.0.0.1:8000/
# Only set to 1 if you are running an HTTPS-capable local proxy/server.
DEV_SECURE_SSL_REDIRECT=0

# ------------------------------------------------------------------------------
# Ops / Retention / Backups (optional knobs)
EZ360_AUDIT_RETENTION_DAYS=365
EZ360_STRIPE_WEBHOOK_RETENTION_DAYS=180

EZ360_BACKUP_DIR=./backups
EZ360_BACKUP_KEEP_LAST=14
EZ360_BACKUP_RETENTION_DAYS=30


# Backups (Phase 6C)
# NOTE: In dev, BACKUP_ENABLED is forced off unless DEV_BACKUP_ENABLED=1.
BACKUP_ENABLED=0
DEV_BACKUP_ENABLED=0
BACKUP_STORAGE=host_managed
# If BACKUP_STORAGE=s3, set these:
BACKUP_S3_BUCKET=
BACKUP_S3_PREFIX=ez360pm/backups/db
BACKUP_RETENTION_DAYS=30
BACKUP_MAX_FILES=90
BACKUP_NOTIFY_EMAILS=


# Trial length (business rule)
EZ360PM_TRIAL_DAYS=14

# CSP rollout (optional)
EZ360_CSP_ENABLED=0
EZ360_PG_DUMP_PATH=

# -----------------------------
# BACKUP SCHEDULING (HOST)
# -----------------------------
# EZ360PM does not schedule backups. Use your host scheduler.
# Examples:
#   python manage.py ez360_backup_db --gzip
#   python manage.py ez360_prune_backups
# After a restore test, record evidence:
#   python manage.py ez360_record_restore_test --outcome pass --notes "..." --backup-file "..."


# --------------------------------------------------------------------------------------
# Media storage (optional S3 via django-storages)
# -----------------------------
# S3 Storage (Media uploads)
# -----------------------------
# Set USE_S3=1 to store uploaded files (receipts, attachments, avatars) in S3.
# Bucket (prod): ez360pm-prod-media (us-east-2)
#
# You must create an IAM user with bucket-limited permissions and paste keys here (Render env vars recommended).
#
USE_S3=0
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_STORAGE_BUCKET_NAME=ez360pm-prod-media
AWS_S3_REGION_NAME=us-east-2
# Optional (for MinIO / DO Spaces / etc.)
AWS_S3_ENDPOINT_URL=
# Optional custom domain for media (recommended later, e.g. media.ez360pm.com via CloudFront)
AWS_S3_CUSTOM_DOMAIN=
AWS_DEFAULT_ACL=

# Optional: override the bucket used for PUBLIC media (defaults to AWS_STORAGE_BUCKET_NAME)
S3_PUBLIC_MEDIA_BUCKET=
# Folder prefix in the bucket for public media (keep as-is unless you want root-level writes)
S3_PUBLIC_MEDIA_LOCATION=public-media

# Direct-to-S3 presigned uploads (optional; keep off until you enable the storage app endpoints)
S3_DIRECT_UPLOADS=0
S3_PRESIGN_EXPIRE_SECONDS=120
S3_PRESIGN_MAX_SIZE_MB=50
PLAID_ENABLED=false
PLAID_ENV=sandbox  # sandbox|development|production (production may require Plaid business verification)
PLAID_CLIENT_ID=
PLAID_SECRET=
