{# templates/timetracking/_time_dropdown.html #}
<div class="p-2">
  {% if active_entry %}
    <div class="d-flex align-items-start gap-2 mb-2" data-timer-start="{{ active_entry.start_time|date:'c' }}">
      <div class="flex-grow-1">
        <div class="small text-muted">Running</div>
        <div class="fw-semibold">
          {{ active_entry.project.name }}
          <span class="ms-2 badge bg-success">LIVE <span data-timer-out>--:--:--</span></span>
        </div>
      </div>
      <form data-post method="post" action="{% url 'timetracking:timer_stop' %}">
        {% csrf_token %}
        <button class="btn btn-sm btn-outline-danger"><i class="bi bi-stop-fill me-1"></i>Stop</button>
      </form>
    </div>

    {# Save current running entry (project/notes) #}
    <form data-post method="post" action="{% url 'timetracking:timer_save' %}" class="mb-2">
      {% csrf_token %}
      <input type="hidden" name="entry_id" value="{{ active_entry.pk }}">
      <div class="mb-2">
        {{ form.project }}
      </div>
      <div class="mb-2">
        {{ form.notes }}
      </div>
      <button class="btn btn-sm btn-primary"><i class="bi bi-save me-1"></i>Save</button>
    </form>

    {# Separate forms (no nesting): delete the running entry #}
    <div class="d-flex gap-2">
      <form data-post method="post" action="{% url 'timetracking:timer_delete' active_entry.pk %}">
        {% csrf_token %}
        <button class="btn btn-sm btn-outline-danger"><i class="bi bi-trash me-1"></i>Delete</button>
      </form>
    </div>
  {% else %}
    <div class="mb-2">
      <div class="small text-muted mb-1">No active timer</div>
      <form data-post method="post" action="{% url 'timetracking:timer_start' %}" class="d-flex gap-2 align-items-start">
        {% csrf_token %}
        {{ form.project }}
        <button class="btn btn-sm btn-success"><i class="bi bi-play-fill me-1"></i>Start</button>
      </form>
    </div>
  {% endif %}

  <hr class="my-2">

  <div>
    <div class="small text-muted mb-1">Recent</div>
    {% if recent_entries %}
      <ul class="list-unstyled mb-0">
        {% for t in recent_entries %}
          <li class="d-flex align-items-center justify-content-between py-1">
            <div class="me-2">
              <div class="fw-semibold">{{ t.project.name }}</div>
              <div class="small text-muted">
                {{ t.start_time|date:"Y-m-d H:i" }}
                {% if t.end_time %} • {{ t.duration_seconds|floatformat:0 }}s{% else %} • running{% endif %}
              </div>
              {% if t.notes %}<div class="small">{{ t.notes|truncatechars:80 }}</div>{% endif %}
            </div>
            <div class="d-flex gap-1">
              {# Optional edit link can be added when an edit route exists #}
              {% if not t.is_running %}
                <form data-post method="post" action="{% url 'timetracking:timer_delete' t.pk %}">
                  {% csrf_token %}
                  <button class="btn btn-sm btn-outline-danger" title="Delete"><i class="bi bi-trash"></i></button>
                </form>
              {% endif %}
            </div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <div class="text-muted small">No recent entries.</div>
    {% endif %}
  </div>
</div>
